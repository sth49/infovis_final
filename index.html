<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    /> -->

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ"
      crossorigin="anonymous"
    />
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/2.25.6/d3-legend.min.js"></script>
    <script src="components/scatterplot.js"></script>
    <script src="components/histogram.js"></script>
    <script src="components/datatable.js"></script>
    <script src="components/dataloader.js"></script>
    <script src="components/lineChart.js"></script>
    <script src="components/tsnescatterplot.js"></script>
    <script src="components/heatmap.js"></script>

    <title>BOHB Experiment Result</title>
    <style>
      body {
        background: #eee;
        overflow-y: scroll;
      }

      .container {
        width: 1500px;
        background: white;
        overflow-x: auto;
      }

      /* In the <style> tag in index.html */
      .brushed {
        stroke-width: 1;
        stroke: gray;
        r: 5;
      }
      .accordion {
        width: 90%;
        padding-right: 0;
        padding-left: 0;
        margin-right: auto;
        margin-left: auto;
      }
      .container {
        width: 90%;
        padding-right: 0;
        padding-left: 0;
        /* margin-right: auto;
        margin-left: auto; */
      }
      .container .checkbox {
        width: 90%;
        padding-left: 0;
        margin-top: 1%;
        margin-left: auto;
      }
      .container .select {
        width: 90%;
        padding-left: 0;
        margin-top: 1%;
        margin-left: auto;
      }
      .accordion-body .container .row {
        width: 100%;
        padding-right: 0;
        padding-left: 0;
        /* margin-right: auto; */
        /* margin-left: auto; */
      }
      .col-4 {
        color: gray;
      }
      h6 {
        color: black;
      }
      .form-select {
        width: 80%;
      }
    </style>
  </head>

  <body>
    <header>
      <nav class="container navbar navbar-light bg-light">
        <div class="container-fluid">
          <span class="navbar-brand mb-0 h1">BOHB Experiment</span>
        </div>
      </nav>
    </header>

    <main class="container pb-3">
      <div class="accordion" id="accordionExample">
        <div class="accordion-item">
          <h2 class="accordion-header">
            <p
              class="accordion-button"
              data-bs-target="#collapseOne"
              aria-expanded="true"
              aria-controls="collapseOne"
            >
              Experiment Overview
            </p>
          </h2>
          <div
            id="collapseOne"
            class="accordion-collapse collapse show"
            data-bs-parent="#accordionExample"
          >
            <div class="accordion-body">
              <div class="container">
                <div class="row">
                  <div class="col-4 p-3 mb-2">
                    <div class="border-bottom">
                      <h6>Overview</h6>
                    </div>
                    <div class="container">
                      <div class="row">
                        <div class="col">Dataset</div>
                        <div class="col">MNIST</div>
                      </div>
                      <div class="row">
                        <div class="col">Metric</div>
                        <div class="col">Accuracy</div>
                      </div>
                      <div class="row">
                        <div class="col">Budget</div>
                        <div class="col">100</div>
                      </div>
                    </div>
                  </div>
                  <div class="col-sm-8 p-3">
                    <div class="border-bottom">
                      <h6>Hyperparameter Space</h6>
                    </div>
                    <div class="container">
                      <div class="row">
                        <div class="col-4">Sample Type</div>
                        <div class="col">
                          <span class="badge text-bg-primary">random</span>
                          <span class="badge text-bg-primary">samples</span>
                          <span class="badge text-bg-primary">BO</span>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-4">Batch Size</div>
                        <div class="col">
                          <span class="badge text-bg-secondary">16</span>
                          <span class="badge text-bg-secondary">32</span>
                          <span class="badge text-bg-secondary">64</span>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-4">Optimizer</div>
                        <div class="col">
                          <span class="badge text-bg-success">RMSprop</span>
                          <span class="badge text-bg-success">Adam</span>
                          <span class="badge text-bg-success">SGD</span>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-4">Momentum</div>
                        <div class="col">1e-4</div>
                      </div>
                      <div class="row">
                        <div class="col-4">Hidden Size</div>
                        <div class="col">
                          <span class="badge text-bg-warning">16</span>
                          <span class="badge text-bg-warning">32</span>
                          <span class="badge text-bg-warning">64</span>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-4">Scheduler</div>
                        <div class="col">
                          <span class="badge text-bg-danger">True</span>
                          <span class="badge text-bg-danger">False</span>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-4">Learning Rate</div>
                        <div class="col">1e-4</div>
                      </div>
                      <div class="row">
                        <div class="col-4">Activation</div>
                        <div class="col">
                          <span class="badge text-bg-info">relu</span>
                          <span class="badge text-bg-info">lrelu</span>
                          <span class="badge text-bg-info">tanh</span>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-4">Weight Decay</div>
                        <div class="col">1e-4</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="container checkbox">
        <input
          type="checkbox"
          class="btn-check"
          id="btn-check-outlined"
          autocomplete="off"
        />
        <label
          class="btn btn-outline-primary"
          for="btn-check-outlined"
          id="label-text"
          >Average Accuracy</label
        ><br />
      </div>
      <div class="text-center">
        <svg width="400" height="400" id="linechart"></svg>
        <svg width="400" height="400" id="heatmap"></svg>
        <svg width="400" height="400" id="scatterplot"></svg>
        <svg width="400" height="400" id="tsne"></svg>
        <svg width="400" height="400" id="histogram"></svg>
      </div>

      <div class="container select">
        <div class="row" style="width: 90%">
          <div class="col" style="text-align: center">
            <h5>Sorted By....</h5>
          </div>
          <div class="col">
            <select
              class="form-select"
              aria-label="Default select example"
              id="selectForm"
            >
              <option selected value="sample_id">Sample ID</option>
              <option value="budget">Budget</option>
              <option value="config_batch_size">Batch Size</option>
              <option value="config_optimizer">Optimizer</option>
              <option value="config_momentum">Momentum</option>
              <option value="config_hidden_size">Hidden Size</option>
              <option value="config_lerning_rate">Learning rate</option>
              s
              <option value="config_activation">Activation</option>
              <option value="config_weight_decay">Weight Decay</option>
              <option value="sample_loss">Loss</option>
              <option value="sample_acc">Accuracy</option>
            </select>
          </div>
        </div>
      </div>

      <table class="table table-striped text-center" style="overflow-x: auto">
        <thead>
          <tr>
            <th>Sample Id</th>
            <th>Budget</th>
            <th>Sample type</th>
            <th>Batch size</th>
            <th>Optimizer</th>
            <th>Momentum</th>
            <th>Hidden size</th>
            <th>Scheduler</th>
            <th>Learning rate</th>
            <th>Activation</th>
            <th>Weight Decay</th>
            <th>Loss</th>
            <th>Accuracy</th>
          </tr>
        </thead>
        <tbody id="data-table"></tbody>
      </table>
    </main>
  </body>
  <script>
    let data, tsnescatterplot, histogram, dataTable, scatterplot;
    let heatmap;
    let data2;
    let linechart;
    let selected = null;
    let brushedData = null;
    let updateType = "all";
    const checkbox = document.getElementById("btn-check-outlined");
    const labelText = document.getElementById("label-text");
    const selectForm = document.getElementById("selectForm");

    function updateTsneScatterplot() {
      tsnescatterplot.update(
        selected === null ? data.data : data.brackets[selected]
      );
    }
    function updateScatterplot() {
      scatterplot.update(
        selected === null ? data.data : data.brackets[selected]
      );
    }
    function updateLineChart(dataType) {
      linechart.update(dataType);
    }

    function updateHistogram() {
      if (updateType === "all") {
        data2 = data.data;
      }
      if (updateType === "brush") {
        data2 =
          brushedData && brushedData.length > 0
            ? brushedData
            : selected === null
            ? data.data
            : data.brackets[selected];
      }
      if (updateType === "linechart") {
        data2 = data.brackets[selected] ? data.brackets[selected] : data.data;
      }

      histogram.update(data2);
    }

    function updateDataTable(sortingType = "sample_id") {
      if (updateType === "all") {
        data2 = data.data;
      }
      if (updateType === "brush") {
        data2 =
          brushedData && brushedData.length > 0
            ? brushedData
            : selected === null
            ? data.data
            : data.brackets[selected];
      }
      if (updateType === "linechart") {
        data2 = data.brackets[selected] ? data.brackets[selected] : data.data;
      }
      dataTable.update(data2, sortingType);
    }

    d3.csv(
      "https://docs.google.com/spreadsheets/d/e/2PACX-1vQBFaIz7UtP909w7G_3q39Sf4qt0jA43ITVpq5k4fj6XXcMb33iVsNBmtCcZKFR0tlkNTAmj-PxYvIW/pub?gid=1850991007&single=true&output=csv"
    ).then((csvData) => {
      csvData.forEach((d) => {
        d["id"] = d["bracket"] + "-" + d["round"] + "-" + d["trial"];
        d["bracket"] = +d["bracket"];
        d["round"] = +d["round"];
        d["trial"] = +d["trial"];
        d["budget"] = +d["budget"];
        d["config_batch_size"] = +d["config_batch_size"];
        d["config_momentum"] = +d["config_momentum"];
        d["config_hidden_size"] = +d["config_hidden_size"];
        d["config_lerning_rate"] = +d["config_lerning_rate"];
        d["config_weight_decay"] = +d["config_weight_decay"];
        d["sample_loss"] = +d["sample_loss"];
        d["sample_acc"] = +d["sample_acc"];
        d["x"] = +d["x"];
        d["y"] = +d["y"];
      });
      d3.csv(
        "https://docs.google.com/spreadsheets/d/e/2PACX-1vS3LGYQ8M_0AyQT_6jo6-c-A5x7lQ-D7tTwZqGNIXXxEg1oixoAxFKNI5Yrk4ZyIJcZP2lPoZf-JTw8/pub?gid=0&single=true&output=csv"
      ).then((csvData2) => {
        csvData2.forEach((d) => {
          d["value"] = +d["value"];
        });
        data = new DataLoader(csvData, csvData2);
        console.log(data.rounds_best);
        console.log(data.rounds);
        console.log(data.linechart);
        console.log(data.linechart2);

        scatterplot = new Scatterplot("#scatterplot");
        scatterplot.initialize();

        tsnescatterplot = new TsneScatterplot("#tsne");
        tsnescatterplot.initialize();

        heatmap = new Heatmap("#heatmap", data.corr);
        heatmap.initialize();
        linechart = new LineChart("#linechart", data);
        linechart.initialize(data.linechart2);
        histogram = new Histogram("#histogram");
        histogram.initialize();
        dataTable = new DataTable("#data-table", data.data.columns);

        updateDataTable();

        updateLineChart("linechart");
        linechart.on("clicked", (dtype) => {
          selected = dtype;
          updateScatterplot();
          updateTsneScatterplot();
          updateType = "linechart";
          updateHistogram();
          updateDataTable();
          selectForm.value = "sample_id";
        });

        updateTsneScatterplot();
        updateScatterplot();
        updateHistogram();
        tsnescatterplot.on("brush", (brushedItems) => {
          brushedData = brushedItems;
          updateType = "brush";
          updateDataTable();
          updateHistogram();
          selectForm.value = "sample_id";
        });
        selectForm.addEventListener("change", function () {
          // console.log(this.value);
          updateDataTable(this.value);
        });
        checkbox.addEventListener("change", function () {
          if (checkbox.checked) {
            updateLineChart("linechart2");
            labelText.textContent = "Best Accuracy";
          } else {
            updateLineChart("linechart");
            labelText.textContent = "Average Accuracy";
          }
        });
      });
    });
  </script>
</html>
